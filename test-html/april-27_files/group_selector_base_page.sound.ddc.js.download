define(['dart_sdk', 'packages/web_client/core/bloc/welcome/welcome_bloc', 'packages/web_client/ui/components/loading_indicator', 'packages/web_client/data/implementations/repository', 'packages/web_client/ui/components/error_message', 'packages/web_client/ui/components/selector'], (function load__packages__web_client__ui__pages__group_selector_base_page(dart_sdk, packages__web_client__core__bloc__welcome__welcome_bloc, packages__web_client__ui__components__loading_indicator, packages__web_client__data__implementations__repository, packages__web_client__ui__components__error_message, packages__web_client__ui__components__selector) {
  'use strict';
  const core = dart_sdk.core;
  const html = dart_sdk.html;
  const _interceptors = dart_sdk._interceptors;
  const dart = dart_sdk.dart;
  const dartx = dart_sdk.dartx;
  const welcome_bloc = packages__web_client__core__bloc__welcome__welcome_bloc.core__bloc__welcome__welcome_bloc;
  const loading_indicator = packages__web_client__ui__components__loading_indicator.ui__components__loading_indicator;
  const repository = packages__web_client__data__implementations__repository.data__implementations__repository;
  const error_message = packages__web_client__ui__components__error_message.ui__components__error_message;
  const selector$ = packages__web_client__ui__components__selector.ui__components__selector;
  var group_selector_base_page = Object.create(dart.library);
  var $innerHtml = dartx.innerHtml;
  var $remove = dartx.remove;
  var $isEmpty = dartx.isEmpty;
  var $addEventListener = dartx.addEventListener;
  dart._checkModuleNullSafetyMode(true);
  var T = {
    JSArrayOfString: () => (T.JSArrayOfString = dart.constFn(_interceptors.JSArray$(core.String)))(),
    ListOfString: () => (T.ListOfString = dart.constFn(core.List$(core.String)))(),
    VoidTodynamic: () => (T.VoidTodynamic = dart.constFn(dart.fnType(dart.dynamic, [])))(),
    EventToNull: () => (T.EventToNull = dart.constFn(dart.fnType(core.Null, [html.Event])))()
  };
  const CT = Object.create({
    _: () => (C, CT)
  });
  var I = ["package:web_client/ui/pages/group_selector_base_page.dart"];
  group_selector_base_page.GroupSelectorBasePage = class GroupSelectorBasePage extends core.Object {
    initiateLoading(state, bloc) {
      let t0;
      if (welcome_bloc.WelcomeComponentLoading.is(state)) {
        t0 = html.document.querySelector("#" + "groupSelectorPlaceholder");
        t0 == null ? null : t0[$innerHtml] = loading_indicator.makeLoadingIndicator();
        bloc.add(new welcome_bloc.WelcomeComponentLoad.new());
      }
    }
    showAndBindSelector(opts) {
      let t0, t0$, t0$0;
      let state = opts && 'state' in opts ? opts.state : null;
      let bloc = opts && 'bloc' in opts ? opts.bloc : null;
      let firstOptionBlank = opts && 'firstOptionBlank' in opts ? opts.firstOptionBlank : null;
      if (welcome_bloc.WelcomeComponentLoaded.is(state)) {
        let groups = state.groups;
        let placeholder = html.document.querySelector("#" + "groupSelectorPlaceholder");
        let groupsSorted = null;
        if (!firstOptionBlank) {
          let localGroupId = repository.Repository.instance.groupId;
          groupsSorted = T.JSArrayOfString().of([localGroupId]);
          let groupsCopy = T.ListOfString().from(groups);
          groupsCopy[$remove](localGroupId);
          dart.dsend(groupsSorted, 'addAll', [groupsCopy]);
        }
        if (groups[$isEmpty]) {
          t0 = placeholder;
          t0 == null ? null : t0[$innerHtml] = error_message.makeMessage("loading-error", group_selector_base_page.GroupSelectorBasePage.errorMessageLoadGroups);
        } else {
          t0$ = placeholder;
          t0$ == null ? null : t0$[$innerHtml] = selector$.makeSelector({id: "groups", elements: T.ListOfString().as(dart.fn(() => firstOptionBlank === true ? groups : groupsSorted, T.VoidTodynamic())()), firstOptionBlank: firstOptionBlank});
          let selector = html.document.querySelector("#groups");
          t0$0 = selector;
          t0$0 == null ? null : t0$0[$addEventListener]("change", dart.fn(event => {
            let selectedGroup = dart.nullCheck(html.SelectElement.as(selector).value);
            bloc.add(new welcome_bloc.WelcomeComponentSelect.new(selectedGroup));
          }, T.EventToNull()));
        }
      }
    }
  };
  (group_selector_base_page.GroupSelectorBasePage.new = function() {
    ;
  }).prototype = group_selector_base_page.GroupSelectorBasePage.prototype;
  dart.addTypeTests(group_selector_base_page.GroupSelectorBasePage);
  dart.addTypeCaches(group_selector_base_page.GroupSelectorBasePage);
  dart.setMethodSignature(group_selector_base_page.GroupSelectorBasePage, () => ({
    __proto__: dart.getMethods(group_selector_base_page.GroupSelectorBasePage.__proto__),
    initiateLoading: dart.fnType(dart.void, [welcome_bloc.WelcomeState, welcome_bloc.WelcomeBloc]),
    showAndBindSelector: dart.fnType(dart.void, [], {}, {bloc: welcome_bloc.WelcomeBloc, firstOptionBlank: core.bool, state: welcome_bloc.WelcomeState})
  }));
  dart.setLibraryUri(group_selector_base_page.GroupSelectorBasePage, I[0]);
  dart.defineLazy(group_selector_base_page.GroupSelectorBasePage, {
    /*group_selector_base_page.GroupSelectorBasePage.selectorPlaceholderId*/get selectorPlaceholderId() {
      return "groupSelectorPlaceholder";
    },
    /*group_selector_base_page.GroupSelectorBasePage.errorMessageLoadGroups*/get errorMessageLoadGroups() {
      return "Не удалось загрузить группы. Повторите попытку позже.";
    }
  }, false);
  dart.trackLibraries("packages/web_client/ui/pages/group_selector_base_page", {
    "package:web_client/ui/pages/group_selector_base_page.dart": group_selector_base_page
  }, {
  }, '{"version":3,"sourceRoot":"","sources":["group_selector_base_page.dart"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;oBA8BoC,OAAmB;;AACnD,UAAU,wCAAN,KAAK;AAEmB,aAD1B,AAAS,4BAAc,AAAyB;qBAAvC,OAA0C,iBAC/C;AAC4B,QAAhC,AAAK,IAAD,KAAK;;IAEb;;;UAG2B;UACF;UACP;AAChB,UAAU,uCAAN,KAAK;AACD,qBAAS,AAAM,KAAD;AACd,0BAAc,AAAS,4BAAc,AAAyB;AAEhE;AAEJ,aAAK,gBAAgB;AACb,6BAA0B,AAAS;AACZ,UAA7B,eAAe,wBAAC,YAAY;AACxB,2BAAa,sBAAkB,MAAM;AACV,UAA/B,AAAW,UAAD,UAAQ,YAAY;AACC,UAAlB,WAAb,YAAY,aAAQ,UAAU;;AAGhC,YAAI,AAAO,MAAD;AAEgD,eADxD,WAAW;uBAAX,OAAa,iBACT,0BAAY,iBAAiB;;AAOM,gBALvC,WAAW;wBAAX,OAAa,kBAAY,4BACjB,wCACM,AAET,cADQ,AAAiB,gBAAD,KAAI,OAAO,MAAM,GAAG,YAAY,2CAEvC,gBAAgB;AAEhC,yBAAW,AAAS,4BAAc;AAItC,iBAHF,QAAQ;yBAAR,OAAU,wBAAiB,UAAU,QAAC;AAC9B,gCAAiD,eAAvB,AAAkB,sBAA3B,QAAQ;AACgB,YAA/C,AAAK,IAAD,KAAK,4CAAuB,aAAa;;;;IAIrD;;;;EACF;;;;;;;;;;MAjDe,oEAAqB;;;MACrB,qEAAsB","file":"group_selector_base_page.sound.ddc.js"}');
  // Exports:
  return {
    ui__pages__group_selector_base_page: group_selector_base_page
  };
}));

//# sourceMappingURL=group_selector_base_page.sound.ddc.js.map
