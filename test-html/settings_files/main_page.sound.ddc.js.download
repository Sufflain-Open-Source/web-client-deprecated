define(['dart_sdk', 'packages/web_client/core/entities/timetable', 'packages/web_client/core/bloc/observe_timetables/observe_timetables_bloc', 'packages/web_client/ui/components/loading_indicator', 'packages/web_client/ui/pages/timetable_page', 'packages/web_client/ui/components/back_button', 'packages/web_client/ui/components/list_element_card', 'packages/web_client/core/contracts/page_contract'], (function load__packages__web_client__ui__pages__main_page(dart_sdk, packages__web_client__core__entities__timetable, packages__web_client__core__bloc__observe_timetables__observe_timetables_bloc, packages__web_client__ui__components__loading_indicator, packages__web_client__ui__pages__timetable_page, packages__web_client__ui__components__back_button, packages__web_client__ui__components__list_element_card, packages__web_client__core__contracts__page_contract) {
  'use strict';
  const core = dart_sdk.core;
  const _interceptors = dart_sdk._interceptors;
  const html = dart_sdk.html;
  const dart = dart_sdk.dart;
  const dartx = dart_sdk.dartx;
  const timetable = packages__web_client__core__entities__timetable.core__entities__timetable;
  const observe_timetables_bloc = packages__web_client__core__bloc__observe_timetables__observe_timetables_bloc.core__bloc__observe_timetables__observe_timetables_bloc;
  const loading_indicator = packages__web_client__ui__components__loading_indicator.ui__components__loading_indicator;
  const timetable_page = packages__web_client__ui__pages__timetable_page.ui__pages__timetable_page;
  const back_button = packages__web_client__ui__components__back_button.ui__components__back_button;
  const list_element_card = packages__web_client__ui__components__list_element_card.ui__components__list_element_card;
  const page_contract = packages__web_client__core__contracts__page_contract.core__contracts__page_contract;
  var main_page = Object.create(dart.library);
  var $innerHtml = dartx.innerHtml;
  var $querySelectorAll = dartx.querySelectorAll;
  var $id = dartx.id;
  var $currentTarget = dartx.currentTarget;
  var $_get = dartx._get;
  var $addEventListener = dartx.addEventListener;
  var $forEach = dartx.forEach;
  var $length = dartx.length;
  var $toString = dartx.toString;
  var $add = dartx.add;
  var $join = dartx.join;
  dart._checkModuleNullSafetyMode(true);
  var T = {
    JSArrayOfTimetable: () => (T.JSArrayOfTimetable = dart.constFn(_interceptors.JSArray$(timetable.Timetable)))(),
    ObserveTimetablesStateTovoid: () => (T.ObserveTimetablesStateTovoid = dart.constFn(dart.fnType(dart.void, [observe_timetables_bloc.ObserveTimetablesState])))(),
    EventToNull: () => (T.EventToNull = dart.constFn(dart.fnType(core.Null, [html.Event])))(),
    ElementTovoid: () => (T.ElementTovoid = dart.constFn(dart.fnType(dart.void, [html.Element])))(),
    JSArrayOfString: () => (T.JSArrayOfString = dart.constFn(_interceptors.JSArray$(core.String)))()
  };
  const CT = Object.create({
    _: () => (C, CT)
  });
  var I = ["package:web_client/ui/pages/main_page.dart"];
  var _timetables = dart.privateName(main_page, "_timetables");
  main_page.MainPage = class MainPage extends core.Object {
    render() {
      let t0;
      t0 = html.document.querySelector("#root");
      t0 == null ? null : t0[$innerHtml] = this.makeCards();
    }
    listen(bloc) {
      bloc.stream.listen(dart.fn(state => {
        let t0;
        if (observe_timetables_bloc.ObserveTimetablesLoadingContent.is(state)) {
          t0 = html.document.querySelector("#root");
          t0 == null ? null : t0[$innerHtml] = loading_indicator.makeLoadingIndicator();
          bloc.add(new observe_timetables_bloc.ObserveTimetablesLoadContent.new());
        }
        if (observe_timetables_bloc.ObserveTimetablesContentLoaded.is(state)) {
          this[_timetables] = state.timetables;
          this.render();
          this.bindCardsClick();
        }
      }, T.ObserveTimetablesStateTovoid()));
    }
    bindCardsClick() {
      html.document[$querySelectorAll](html.Element, "." + "card")[$forEach](dart.fn(element => {
        element[$addEventListener]("click", dart.fn(event => {
          let t0;
          new timetable_page.TimetablePage.new(timetable.Timetable.as(this[_timetables][$_get](core.int.parse(html.Element.as(event[$currentTarget])[$id])))).render();
          t0 = html.document.querySelector("#back-button");
          t0 == null ? null : t0[$addEventListener]("click", dart.fn(event => {
            back_button.hideBackButton();
            this.render();
          }, T.EventToNull()));
        }, T.EventToNull()));
      }, T.ElementTovoid()));
    }
    makeCards() {
      let cards = T.JSArrayOfString().of([]);
      for (let i = 0; i < this[_timetables][$length]; i = i + 1) {
        cards[$add](list_element_card.makeCard(i[$toString](), core.String.as(dart.dload(this[_timetables][$_get](i), 'linkTitle'))));
      }
      return cards[$join]();
    }
  };
  (main_page.MainPage.new = function() {
    this[_timetables] = T.JSArrayOfTimetable().of([]);
    ;
  }).prototype = main_page.MainPage.prototype;
  dart.addTypeTests(main_page.MainPage);
  dart.addTypeCaches(main_page.MainPage);
  main_page.MainPage[dart.implements] = () => [page_contract.PageContract];
  dart.setMethodSignature(main_page.MainPage, () => ({
    __proto__: dart.getMethods(main_page.MainPage.__proto__),
    render: dart.fnType(dart.void, []),
    listen: dart.fnType(dart.void, [observe_timetables_bloc.ObserveTimetablesBloc]),
    bindCardsClick: dart.fnType(dart.void, []),
    makeCards: dart.fnType(core.String, [])
  }));
  dart.setLibraryUri(main_page.MainPage, I[0]);
  dart.setFieldSignature(main_page.MainPage, () => ({
    __proto__: dart.getFields(main_page.MainPage.__proto__),
    [_timetables]: dart.fieldType(core.List)
  }));
  dart.trackLibraries("packages/web_client/ui/pages/main_page", {
    "package:web_client/ui/pages/main_page.dart": main_page
  }, {
  }, '{"version":3,"sourceRoot":"","sources":["main_page.dart"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgC4D,WAAxD,AAAS,4BAAc;mBAAd,OAAwB,iBAAY;IAC/C;WAEkC;AAa9B,MAZF,AAAK,AAAO,IAAR,eAAe,QAAC;;AAClB,YAAU,2DAAN,KAAK;AAC4D,eAAnE,AAAS,4BAAc;uBAAd,OAAwB,iBAAY;AACL,UAAxC,AAAK,IAAD,KAAK;;AAGX,YAAU,0DAAN,KAAK;AACuB,UAA9B,oBAAc,AAAM,KAAD;AAEX,UAAR;AACgB,UAAhB;;;IAGN;;AAiBI,MAdF,AACK,AACA,+CADiB,AAAgC,wBACzC,QAAC;AAWV,QAVF,AAAQ,OAAD,oBAAkB,SAAS,QAAC;;AAGpB,UAFb,AAEK,4DADG,AAAW,yBAAK,eAA2B,AAAY,gBAAhC,AAAM,KAAD;AAOlC,eAJF,AAAS,4BAAc;uBAAd,OAA+B,sBAAiB,SACrD,QAAC;AACa,YAAhB;AACQ,YAAR;;;;IAIR;;AAGO,kBAAgB;AAErB,eAAS,IAAI,GAAG,AAAE,CAAD,GAAG,AAAY,4BAAQ,IAAA,AAAC,CAAA;AACiC,QAAxE,AAAM,KAAD,OAAK,2BAAsB,AAAE,CAAD,8BAA4B,WAAf,AAAW,yBAAC,CAAC;;AAG7D,YAAO,AAAM,MAAD;IACd;;;IAjDK,oBAAyB;;EAkDhC","file":"main_page.sound.ddc.js"}');
  // Exports:
  return {
    ui__pages__main_page: main_page
  };
}));

//# sourceMappingURL=main_page.sound.ddc.js.map
